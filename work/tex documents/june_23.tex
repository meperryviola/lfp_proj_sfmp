\documentclass{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{listings}
\usepackage{color}
\usepackage{parskip}
\usepackage{multirow}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{dcolumn}
\usepackage{tabularx}
\usepackage{array}
\usepackage{float}
\usepackage{longtable}
\usepackage{setspace}
\usepackage[margin=1.0in]{geometry}
\setlength{\parskip}{1em}

%% some of Shigeru's custom commands, borrowed bc I like his style.

%\addtolength{\textheight}{1in}
\newcommand{\olsec}{VI.}

% \bibpunct{(}{)}{,}{a}{,}{,}
\newcolumntype{.}{D{.}{.}{-1}}
\newcolumntype{d}[1]{D{.}{.}{#1}}

\newcommand{\mct}[1]{\multicolumn{1}{c}{#1}}
\newcommand{\rr}[1]{\multicolumn{1}{r|}{#1}}
\newcommand{\mc}[3]{\multicolumn{#1}{#2}{#3}}

\newcommand{\mr}[3]{\multirow{#1}{#2}{#3}}
\renewcommand{\baselinestretch}{1.2}

\newcommand{\wk}{\cellcolor[gray]{0.92}}
\newcommand{\md}{\cellcolor[gray]{0.8}}
\newcommand{\strg}{\cellcolor[gray]{0.5}}

\newcommand{\wid}[1]{8cm}
\newcommand{\hi}[1]{6cm}


%% end of header
\title{Reconciling LFPR and income measures}
\author{Madison informal notes}
\date{June 28, 2023}

\begin{document} 
	\maketitle
	
	Issue: My LFPRs by income for groups defined by their \textbf{family} income differed significantly from Shigeru's LFPRs by income  groups defined by their \textbf{household} income for the \$25,000$<$ group. There are some legitimate reasons for the disparity, which I cover toward the end of this document. However, investigation revealed a group of people in single-family households with family income $<$ \$25,000 and household income $\ge$ \$25,000, which is nonsensical and prompted suspicion. Further investigation exposed a slew of issues around the use of my constructed variable, unlog\_ftotval, and the way we include in our imputation model ASEC observations where individuals have zero or negative values for family or household income. I describe the problem and my solution. Then I show recomputed LFPRs by family income using the corrected family income variable. Finally, I break apart the difference between my calculations and Shigeru's. 
	
	Define variables used:
	\begin{itemize}
		\item htotval: CPS given household income
		\item ftotval: CPS given family income. This includes cases where ftotval$\le$0.
		\item unlog\_ftotval: $e^{ln(ftotval)}$. This is the variable I use for family income. It takes missing values for people with ftotval$\le$0, unless an intervention is made.
		\item h\_tot\_income\_calc:  (htotval standard items)\footnote{See Shigeru's March memo for thorough definition.} + energy assistance + food stamps + COVID economic impact payments. Takes value zero if its component parts are less than zero\footnote{replace h\_main\_income = 0  if  h\_main\_income$<$0 \\
			replace h\_other\_income = 0 if  h\_other\_income$<$0 \\ 
			gen h\_tot\_income\_calc = h\_main\_income +  h\_other\_income + h\_ben}
	\end{itemize}

	\section{ftotval and unlog\_ftotval}
	 Problem: unlog\_ftotval is the variable we must use for family income after running the log-linear imputation model. The left-hand side variable is ln(ftotval) so only those with ftotval$>$0 can be taken in and used to predict. The predicted values generated by the model are ln(predicted ftotval) so I must exponentiate those values again to get predicted family income in dollars again. Because the prediction model is log-linear, all predicted values will also be $>$0. This means our model will systematically over-predict family income because it is incapable of predicting a zero for family income but clearly we do have those cases in the ASEC data. Inability to incorporate those cases likely compromises the accuracy of the imputation. 
	 
	 \begin{table}[H]
	 	\centering
	 	\caption{Frequency of people with FTOTVAL$\le$\$0 in ASEC}
	 	\begin{tabularx}{0.8\textwidth}{@{\extracolsep{\fill}}r r r r r }
	 		\toprule 
	 		& \mc{4}{c}{Year}  \\ \cmidrule(lr){2-5}
	 		& 		&	\mct{2020}	&	\mct{2021}	&	\mct{2022}	\\ \midrule
	 		ftotval==0 \hspace{0.1cm}  	&	&	1,918	&	2,290	&	2,161	\\
	 		ftotval$<$0 \hspace{0.1cm}  	&	&	30	&	73	&	46	\\
	 		\bottomrule
	 	\end{tabularx}
	 \end{table} 
	
	The question here is how people with negative or no family income ought to be incorporated. What I was doing was letting the people with ftotval$\le$0 take missing values for ln\_ftotval, ultimately resulting in them having missing values for unlog\_ftotval. This meant that when I was computing LFPRs by family income using unlog\_ftotval, I was excluding those people. This is a consequential misstep and one of the reasons my LFPR computation was too high for the below-25k group.
	The following table illustrates how different the estimates are if we rectify the exclusion. The top row is the group for whom I had previously tabulated and the bottom is the corrected group. 
	
	\begin{table}[H]
		\centering
		\caption{Comparing LFPR computations}
		\begin{tabularx}{0.8\textwidth}{@{\extracolsep{\fill}}r r r r r }
			\toprule 
			& \mc{4}{c}{Year}  \\ \cmidrule(lr){2-5}
			& 		&	\mct{2020}	&	\mct{2021}	&	\mct{2022}	\\ \midrule
			0$<$ftotval$<$25k \hspace{0.1cm}  	&	&	36.4	&	34.2	&	34.0	\\
			ftotval$<$25k \hspace{0.1cm}  	&	&	34.3	&	32.1	&	32.2	\\
			\bottomrule
		\end{tabularx}
	\end{table} 
	
	My proposed solution is to replace ln(ftotval) with zero if ftotval$\le$0. This is in-keeping with Shigeru's practice of replacing all negative income values with zero in constructing h\_tot\_income\_calc. Doing this allows those observations to be part of the information set that the regression uses to predict income values, which also rectifies some of the issues of over-prediction at the lowest end of the income distribution. 	
	
	*To flag a potential issue, we know from prior investigation that negative income values are reflective of a business owner taking losses, so it's possible that people with negative incomes shouldn't really be lumped into the lowest-income category.
	
	All computations for the rest of this paper will be done within the universe of ftotval$<$25,000.00. When I say family income, I am referring to ftotval. Bear in mind that unlog\_ftotval==ftotval for all except those with ftotval$\le$0; in those cases, unlog\_ftotval==1 because I replaced ln(ftotval) with 0 instead of a missing value. Since I am using fixed threshold income categories here *AND* I have made aforementioned replacement, there is no difference in using ftotval or unlog\_ftotval to define the family income categories for the ASEC observations. Cases with ftotval$\le$0 end up in the bottom bin either way. What's important is that those cases are now included in the bottom income category (\$0-\$25,000) instead of being excluded from computations. In all computations, I have used the March Supplement frequency weights, marsupwt.
	
	\section{Families and Households} Families are different from households. Households may be single-family or multi-family. Everyone with a household income under \$25k also has a family income under \$25k because in the CPS, families are defined as being a level below household. Household income is equivalent to the sum of the family incomes for each family in the household\footnote{In years 2020, 2021, and 2022, there are 11, 13, and 17 observations, respectively, where this is not true. This makes for a total of 41 out of 367,781 observations.}. This allows for the existence of cases where two families each have family incomes below 25k which sum to a household income greater than 25k. 
	
	Consider four cases in the universe of individuals with family income less than \$25,000:
	
	\begin{enumerate}
		\item In single-family household, family income $<$ \$25,000, household income $<$ \$25,000 
		\item In single-family household, family income $<$ \$25,000, household income $\ge$ \$25,000 
		\item In multi-family household, family income $<$ \$25,000, household income $<$ \$25,000
		\item In multi-family household, family income $<$ \$25,000, household income $\ge$ \$25,000
	\end{enumerate}
	
	Household income being the sum of all family incomes for each family in a household means that there are no instances of the second type\footnote{The singular individual in 2020 in a single family household with family income less than household income puzzles me. Household income is \$239,860 and family income is \$9,600, yet there is only one individual in the household. She is a widower in her 70s, listed as the householder of her house so I don't think it's a group-home situation. She is listed as being NILF - retired but has a listed wage/salary income of \$220,000. My inclination is to ignore this one observation.}. Previously, when I was doing the computations in universe unlog\_ftotval$<$\$25,000 and I had left missing values for everybody ftotval$\le$0, many of these individuals appeared in that group simply because of the high-coded missing value.
	
	\begin{table}[H]
		\centering
		\caption{Frequencies - Family income$<$\$25,000 Universe}
		\begin{tabularx}{0.8\textwidth}{@{\extracolsep{\fill}}r r r r r }
			\toprule 
			& \mc{4}{c}{Year}  \\ \cmidrule(lr){2-5}
			Persons 	& 		&	\mct{2020}	&	\mct{2021}	&	\mct{2022}	\\ \midrule
			Single-family, hh$<$25k \hspace{0.1cm} 		&	&	12,883	&	14,559	&	13,224	\\	
			Single-family, hh$\ge$25k \hspace{0.1cm} 		&	&	1	&	0	&	0	\\	
		
			Multi-family, hh$<$25k \hspace{0.1cm}  	&	&	1,216	&	1,484	&	1,266	\\
			Multi-family, hh$\ge$25k \hspace{0.1cm}  	&	&	3,738	&	4,166	&	3,628	\\
			\midrule
			Total, hh$<$25k \hspace{0.1cm}  	&	&	14,099	&	16,043	&	14,491	\\
			Overall total \hspace{0.1cm}  	&	&	17,838	&	20,209	&	18,118	\\
			\bottomrule
		\end{tabularx}
		\vspace{1mm}
		\vspace{1mm}
	\end{table}
	
	
	My computations of labor force participation were based on family income only, so my below-25k group contains cases 1, 3, and 4 (Overall total). Shigeru's computations of labor force participation were based on household income so his below-25k group contains people from cases 1 and 3 (Total, hh$<$25k).

	
		\begin{table}[H]
		\centering
		\caption{LFPRs - Family income$<$\$25,000 Universe}
		\begin{tabularx}{0.8\textwidth}{@{\extracolsep{\fill}}r r r r r }
			\toprule 
			& \mc{4}{c}{Year}  \\ \cmidrule(lr){2-5}
			\% as of March 	& 		&	\mct{2020}	&	\mct{2021}	&	\mct{2022}	\\ \midrule
			Single-family, hh$<$25k \hspace{0.1cm} 		&	&	28.0	&	26.1	&	25.6	\\	
			Single-family, hh$\ge$25k \hspace{0.1cm} 		&	&	-	&	-	&	-	\\	
			
			Multi-family, hh$<$25k \hspace{0.1cm}  	&	&	35.9	&	34.8	&	41.1	\\
			Multi-family, hh$\ge$25k \hspace{0.1cm}  	&	&	55.1	&	52.2	&	52.3	\\
			\midrule
			hh$<$25k \hspace{0.1cm}  	&	&	28.7	& 	26.9	&	27.1		\\
			Overall total \hspace{0.1cm}  	&	&	34.3	&	32.1	&	32.2	\\
			\bottomrule
		\end{tabularx}
		\vspace{1mm}
		\vspace{1mm}
		\begin{minipage}[t]{\textwidth}
			\footnotesize{\emph{Notes}: Sample is all participants 16+ from the March Supplements with FTOTVAL$<$\$25k. Weights used are marsupwt.}
		\end{minipage}
	\end{table}
	
	
	Notice that the overall LFPR for that group (Total, hh$<$25k) is not exactly as Shigeru had calculated in March. We will see one reason for this in a moment. 
	
	Notice also how much higher the LFPR is for the group that is present in my calculations but not Shigeru's. It makes sense that my number was higher. I will confirm this at the end by showing a sum of weighted averages.
	
	\section{HTOTVAL vs. h\_tot\_income\_calc} Shigeru's household income measure was not simply the one given by CPS (HTOTVAL). Constructing variable h\_tot\_income\_ASEC\_calc, he showed exactly which income line items are encompassed in htotval (see memo from March). To that sum, he added in energy assistance, food stamps, and COVID economic impact payments to create variable h\_tot\_income\_calc. He defines the income groups using *this* measure of household income. This measure takes larger values than HTOTVAL, especially in years 2021 and 2022 because that's when the EIPs are being paid out. This means that there will be more people in those years who fall into the case of family income$<$25k and HH income$>$25k during when we use these numbers for HH income. This is shown here:
	\begin{table}[H]
		\centering
		\caption{Frequencies of people with FTOTVAL$<$\$25k}
		\begin{tabularx}{0.8\textwidth}{@{\extracolsep{\fill}}r r r r r }
			\toprule 
			& \mc{4}{c}{Year}  \\ \cmidrule(lr){2-5}
			Persons 	& 		&	\mct{2020}	&	\mct{2021}	&	\mct{2022}	\\ \midrule
			h\_tot\_income\_calc $\ge$\$25k \hspace{0.1cm}  	&	&	4,174	&	7,503	&	6,692	\\
			h\_tot\_income\_calc $<$\$25k \hspace{0.1cm} 		&	&	13,664	&	12,706	&	11,426	\\
			\midrule
			Total \hspace{0.1cm} 		&	&	17,838	&	20,209	&	18,118	\\
			\bottomrule
		\end{tabularx}
		\vspace{1mm}
		\vspace{1mm}
		\begin{minipage}[t]{\textwidth}
			\footnotesize{\emph{Notes}: Sample is all participants 16+ from the March Supplements with FTOTVAL$<$\$25k}
		\end{minipage}
	\end{table} 
	
	Here are the proportions each case constitutes of the overall subsample (family income$<$25k):
	\begin{table}[H]
		\centering
		\caption{Proportion of subsample}
		\begin{tabularx}{0.8\textwidth}{@{\extracolsep{\fill}}r r r r r }
			\toprule 
			& \mc{4}{c}{Year}  \\ \cmidrule(lr){2-5}
			Persons 	& 		&	\mct{2020}	&	\mct{2021}	&	\mct{2022}	\\ \midrule
			HH income $\ge$\$25k \hspace{0.1cm}  	&	& 0.23		&	0.37	&	0.37	\\
			HH income $<$\$25k \hspace{0.1cm}  	&	&	0.77	&	0.63	&	0.63	\\
			\midrule
			Together \hspace{0.1cm}  	&	&	1.00	&	1.00	&	1.00	\\
			\bottomrule
		\end{tabularx}
		\vspace{1mm}
		\vspace{1mm}
		\begin{minipage}[t]{\textwidth}
			\footnotesize{\emph{Notes}: Sample is all participants 16+ from the March Supplements with FTOTVAL$<$\$25k}
		\end{minipage}
	\end{table}
	
	\begin{table}[H]	
		\centering
		\caption{Mean LFPR of people with FTOTVAL$<$\$25k}
		\begin{tabularx}{0.8\textwidth}{@{\extracolsep{\fill}}r r r r r }
			\toprule 
			& \mc{4}{c}{Year}  \\ \cmidrule(lr){2-5}
			\% as of March	& 		&	\mct{2020}	&	\mct{2021}	&	\mct{2022}	\\ \midrule
			h\_tot\_income\_calc $\ge$\$25k \hspace{0.1cm} 	 &	&	54.1	&	45.0	&	46.6	\\
			h\_tot\_income\_calc $<$\$25k \hspace{0.1cm} 	 &	&	28.2	&	24.7	&	23.9	\\
			\midrule
			Total \hspace{0.1cm} 		&	&	34.3	&	32.1	&	32.2	\\
			\bottomrule
		\end{tabularx}
		\vspace{1mm}
		\vspace{1mm}
		\begin{minipage}[t]{\textwidth}
			\footnotesize{\emph{Notes}: Sample is all participants 16+ from the March Supplements with FTOTVAL$<$\$25k}
				\vspace{1mm}
			\vspace{1mm}
		\end{minipage}

		\begin{tabularx}{0.8\textwidth}{@{\extracolsep{\fill}}r r r r r }
		\toprule 
		\% as of March	& 		&	\mct{2020}	&	\mct{2021}	&	\mct{2022}	\\ \midrule
		Shigeru's March numbers \hspace{0.1cm} 	 &	&	27.8	&	24.4	&	24.1	\\
		\bottomrule
		\end{tabularx}
	\end{table}
	The second row corresponds to the group for whom Shigeru computed labor force participation. As we see, my these values are very close to those he computed in March. Upon review of old code from Shigeru where he computed LFPR by household income, I noticed that the age range of the sample he used was 15+ while mine is 16+. I had chosen 16+ because that is the typical age range the BLS uses when computing the official labor force participation rate. When I change my population to be 15+, my numbers are the following:
	
		\begin{tabularx}{0.8\textwidth}{@{\extracolsep{\fill}}r r r r r }
		\toprule 
		\% as of March	& 		&	\mct{2020}	&	\mct{2021}	&	\mct{2022}	\\ \midrule
		Shigeru's March numbers \hspace{0.1cm} 	 &	&	28.0	&	24.5	&	23.8	\\
		\bottomrule
	\end{tabularx}
	
	
	Multiplying each LFPR by its respective group's proportion and then summing yields the same values as in the `Total' row of Table 6.

	
\end{document}